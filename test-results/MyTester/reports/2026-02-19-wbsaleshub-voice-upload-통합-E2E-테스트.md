# WBSalesHub μμ„± μ—…λ΅λ“(RTZR STT) ν…μ¤νΈ κ²°κ³Ό

**μΌμ‹**: 2026-02-20 00:15 KST (2μ°¨ μ‹¤ν–‰: μ‹¤μ  μμ„±νμΌ μ‚¬μ©)
**ν™κ²½**: μ¤ν…μ΄μ§• (https://staging.workhub.biz:4400/saleshub)
**ν…μ¤νΈ λ€μƒ**: μμ„± μ—…λ΅λ“ β†’ RTZR STT β†’ Claude AI μ”μ•½ νμ΄ν”„λΌμΈ

---

## μ”μ•½

| ν…μ¤νΈ μ ν• | ν†µκ³Ό | μ‹¤ν¨ | μ΄ | ν†µκ³Όμ¨ |
|------------|------|------|-----|-------|
| **API ν†µν•©** | 18 | 0 | 18 | β… 100% |
| **Playwright E2E** | 11 | 0 | 11 | β… 100% |
| **μ‹¤μ  νμΌ API μ—…λ΅λ“** | 1 | 0 | 1 | β… 100% |
| **ν•©κ³„** | **30** | **0** | **30** | β… **100%** |

---

## 1. API ν†µν•© ν…μ¤νΈ (Vitest)

**νμΌ**: `tests/voice/voice-upload-api.test.ts`
**μ‹¤ν–‰ μ‹κ°„**: 567ms

### κ²°κ³Ό

| # | ν…μ¤νΈ | μƒνƒ | μ‹κ°„ |
|---|--------|------|------|
| 1 | β… μΈμ¦ ν™•μΈ (`/auth/me`) | PASS | 62ms |
| 2 | β… `GET /voice/pending-count` β€” λ―Έν™•μΈ λ…ΈνΈ μ | PASS | 13ms |
| 3 | β… `GET /voice/pending-count` β€” 401 λ―ΈμΈμ¦ | PASS | 6ms |
| 4 | β… `GET /voice/templates` β€” ν…ν”λ¦Ώ λ©λ΅ μ΅°ν | PASS | 9ms |
| 5 | β… `POST /voice/upload` β€” μμ„± νμΌ μ—…λ΅λ“ (202 Accepted) | PASS | 18ms |
| 6 | β… `POST /voice/upload` β€” νμΌ μ—†μ΄ μ—…λ΅λ“ (400) | PASS | 9ms |
| 7 | β… `POST /voice/upload` β€” μ§€μ›ν•μ§€ μ•λ” νμΌ ν•μ‹ (500) | PASS | 9ms |
| 8 | β… `POST /voice/upload` β€” 401 λ―ΈμΈμ¦ | PASS | 6ms |
| 9 | β… `GET /voice/status/:noteId` β€” λ³€ν™ μƒνƒ μ΅°ν | PASS | 10ms |
| 10 | β… `GET /voice/status/:noteId` β€” μ΅΄μ¬ν•μ§€ μ•λ” λ…ΈνΈ (404) | PASS | 9ms |
| 11 | β… `POST /voice/confirm/:noteId` β€” pending_confirm μ•„λ‹ μƒνƒ (400) | PASS | 12ms |
| 12 | β… `POST /voice/confirm/:noteId` β€” μ΅΄μ¬ν•μ§€ μ•λ” λ…ΈνΈ (404) | PASS | 11ms |
| 13 | β… `POST /voice/retry/:noteId` β€” μ¬μ‹λ„ (μ¤λ””μ¤ νμΌ μ—†μ 400) | PASS | 12ms |
| 14 | β… `POST /voice/templates` β€” ν…ν”λ¦Ώ μƒμ„± (κ΄€λ¦¬μ 403) | PASS | 8ms |
| 15 | β… `PUT /voice/templates/:id` β€” ν…ν”λ¦Ώ μμ • (μ¤ν‚µ) | PASS | 0ms |
| 16 | β… `DELETE /voice/templates/:id` β€” ν…ν”λ¦Ώ μ‚­μ  (μ¤ν‚µ) | PASS | 0ms |
| 17 | β… λ―Έν…λ…ΈνΈ λ©λ΅μ— VOICE_UPLOAD ν¬ν•¨ ν™•μΈ | PASS | 13ms |
| 18 | β… ν…μ¤νΈ λ°μ΄ν„° μ •λ¦¬ | PASS | 0ms |

### μ£Όμ” κ²€μ¦ ν•­λ©
- μΈμ¦: μ„Έμ… μΏ ν‚¤ κΈ°λ° λ΅κ·ΈμΈ λ° μΈμ¦ μ •μƒ
- νμΌ μ—…λ΅λ“: λ”λ―Έ WAV(32KB) β†’ 202 μ‘λ‹µ + noteId λ°ν™
- μƒνƒ νλ¦„: `transcribing` β†’ `failed` (RTZR API λ―Έμ„¤μ •μΌλ΅ μ¦‰μ‹ μ‹¤ν¨)
- μ—λ¬ ν•Έλ“¤λ§: λ―ΈμΈμ¦(401), νμΌ μ—†μ(400), μ΅΄μ¬ν•μ§€ μ•λ” λ…ΈνΈ(404)
- ν…ν”λ¦Ώ: κΈ°λ³Έ ν…ν”λ¦Ώ 1κ° ν™•μΈ, κ΄€λ¦¬μ κ¶ν• κ²€μ¦(403)

---

## 2. μ‹¤μ  μμ„± νμΌ API μ—…λ΅λ“ ν…μ¤νΈ

**νμΌ**: `ν…μ¤νΈ μμ„±νμΌ.m4a` (9.2MB)
**λ°©λ²•**: Node.js fetch APIλ΅ μ§μ ‘ μ—…λ΅λ“

### κ²°κ³Ό

| ν•­λ© | κ°’ |
|------|-----|
| HTTP μ‘λ‹µ | 202 Accepted |
| noteId | `66c1e3ef-cb74-4a9d-b84a-d927da55d26c` |
| μ΄κΈ° μƒνƒ | `transcribing` |
| μµμΆ… μƒνƒ | `failed` |
| μ‹¤ν¨ μ‚¬μ  | RTZR API μΈμ¦ μ •λ³΄ λ―Έμ„¤μ • |

**μƒμ„Έ**: νμΌ μ—…λ΅λ“ μμ²΄λ” μ„±κ³µ. μ„λ²„κ°€ νμΌμ„ λ°›μ•„ meeting_noteλ¥Ό μƒμ„±ν•κ³  RTZR STT ν”„λ΅μ„Έμ„λ¥Ό μ‹μ‘ν–μΌλ‚, `RTZR_CLIENT_ID`μ™€ `RTZR_CLIENT_SECRET` ν™κ²½λ³€μκ°€ μ¤ν…μ΄μ§•μ— μ„¤μ •λμ§€ μ•μ•„ μ¦‰μ‹ μ‹¤ν¨.

---

## 3. Playwright E2E ν…μ¤νΈ (μ‹¤μ  μμ„±νμΌ μ‚¬μ©)

**νμΌ**: `e2e/voice/voice-upload-e2e.spec.ts`
**μ‹¤ν–‰ μ‹κ°„**: 1λ¶„ 30μ΄
**μμ„± νμΌ**: `ν…μ¤νΈ μμ„±νμΌ.m4a` (9.2MB, μ‹¤μ  ν•κµ­μ–΄ λ…Ήμ)

### κ²°κ³Ό

| # | ν…μ¤νΈ | μƒνƒ | μ‹κ°„ |
|---|--------|------|------|
| 1 | β… λ€μ‹λ³΄λ“ β€” λ§μ΄ν¬ λ²„νΌ ν‘μ‹ | PASS | 5.8s |
| 2 | β… λ€μ‹λ³΄λ“ β€” μ¤λ””μ¤ νμΌ μ…λ ¥ (hidden input) | PASS | 5.0s |
| 3 | β… μ‚¬μ΄λ“λ°” β€” λ―Έν…λ…ΈνΈ λ§ν¬ | PASS | 5.1s |
| 4 | β… λ―Έν…λ…ΈνΈ νμ΄μ§€ β€” μμ„± μ—…λ΅λ“ λ²„νΌ | PASS | 7.2s |
| 5 | β… λ―Έν…λ…ΈνΈ νμ΄μ§€ β€” μƒ λ―Έν…λ…ΈνΈ λ²„νΌ | PASS | 6.6s |
| 6 | β… λ―Έν…λ…ΈνΈ νμ΄μ§€ β€” μμ„± μ—…λ΅λ“ λ…ΈνΈ λ°°μ§€ ν‘μ‹ | PASS | 8.9s |
| 7 | β… μμ„± μ—…λ΅λ“ λ¨λ‹¬ β€” μ—΄κΈ°/λ‹«κΈ° | PASS | 7.5s |
| 8 | β… μμ„± μ—…λ΅λ“ λ¨λ‹¬ β€” μ‹¤μ  νμΌ μ—…λ΅λ“ (9.2MB m4a) | PASS | 18.3s |
| 9 | β… ν™•μΈ λ¨λ‹¬ β€” pending_confirm λ…ΈνΈ μ—†μ (μ¤ν‚µ) | PASS | 7.7s |
| 10 | β… λ―Έν…λ…ΈνΈ μΉ΄λ“ β€” μƒνƒλ³„ ν‘μ‹ | PASS | 7.7s |
| 11 | β… μ†μ¤ λ°°μ§€ μƒ‰μƒ β€” VOICE_UPLOAD λ…Ήμƒ‰ λ°°μ§€ | PASS | 7.9s |

### μ£Όμ” κ²€μ¦ ν•­λ©
- λ€μ‹λ³΄λ“: QuickMemoInput λ§μ΄ν¬ λ²„νΌ + hidden file input (`accept=".wav,.mp3,.m4a,.flac,.aac,.ogg,.webm"`)
- μ‚¬μ΄λ“λ°”: λ―Έν…λ…ΈνΈ λ„¤λΉ„κ²μ΄μ… λ§ν¬ μ΅΄μ¬
- λ―Έν…λ…ΈνΈ νμ΄μ§€: "μμ„± μ—…λ΅λ“" λ²„νΌ, "μƒ λ―Έν…λ…ΈνΈ" λ²„νΌ
- VoiceUploadModal: λ¨λ‹¬ μ—΄κΈ°/λ‹«κΈ°, λ“λκ·Έμ•¤λ“λ΅­ μμ—­, **μ‹¤μ  m4a νμΌ(9.2MB) μ„ νƒ λ° μ—…λ΅λ“ μ„±κ³µ**
- νμΌ μ„ νƒ μ‹ νμΌλ…(`ν…μ¤νΈ μμ„±νμΌ.m4a`) μ •μƒ ν‘μ‹
- MeetingNoteCard: VOICE_UPLOAD μ†μ¤ λ°°μ§€(λ…Ήμƒ‰) ν™•μΈ
- μ¤ν¬λ¦°μƒ· μΊ΅μ²: 11κ° μ¤ν¬λ¦°μƒ· μ €μ¥

---

## 4. λ°κ²¬ μ΄μ λ° μμ • λ‚΄μ—­

### π”΄ Critical β€” DB λ§μ΄κ·Έλ μ΄μ… λ§¤ μ¬μ‹μ‘λ§λ‹¤ ν…μ΄λΈ” DROP

- **λ¬Έμ **: `004_fix_accounts_id_type.sql`κ³Ό `005_fix_meeting_notes_user_id_types.sql`μ΄ μ„λ²„ μ¬μ‹μ‘λ§λ‹¤ ν…μ΄λΈ”μ„ DROP+CREATE β†’ λ¨λ“  λ°μ΄ν„° μ†μ‹¤ + μƒ UUID μƒμ„±
- **μν–¥**: λΈλΌμ°μ € μ„Έμ…μ UUIDκ°€ DBμ μƒ UUIDμ™€ λ¶μΌμΉ β†’ `foreign key constraint` μ—λ¬ (500)
- **μμ •**: λ‘ λ§μ΄κ·Έλ μ΄μ…μ— μ΅°κ±΄λ¶€ μ²΄ν¬ μ¶”κ°€ β€” μ»¬λΌ νƒ€μ…μ΄ μ΄λ―Έ UUIDμ΄λ©΄ DROP κ±΄λ„λ€
- **μ»¤λ°‹**: `d5edbc9` ("fix: DB λ§μ΄κ·Έλ μ΄μ… λ§¤ μ¬μ‹μ‘λ§λ‹¤ ν…μ΄λΈ” DROP λ°©μ§€")

### π”΄ Critical β€” SalesHub κ³„μ • λ―Έμƒμ„±
- **λ¬Έμ **: ν…μ¤νΈ κ³„μ •μ΄ HubManager `users` ν…μ΄λΈ”μ—λ§ μ΅΄μ¬, SalesHub `accounts` ν…μ΄λΈ”μ— μ—†μ–΄ μ„Έμ… `user.id`κ°€ μ •μ(29)λ΅ μ„¤μ •λ¨ β†’ UUID μ»¬λΌ νƒ€μ… λ¶μΌμΉ
- **μμ •**: SalesHub `accounts` ν…μ΄λΈ”μ— test@wavebridge.com κ³„μ • μƒμ„± (UUID: `2843c608-fd59-4c26-a544-5a345530e42c`)

### π”΄ Critical β€” Peter μ„Έμ… UUID λ¶μΌμΉ
- **λ¬Έμ **: 004 λ§μ΄κ·Έλ μ΄μ…μ΄ accounts ν…μ΄λΈ”μ„ μ¬μƒμ„±ν•λ©΄μ„ Peter κ³„μ •μ— μƒ UUID ν• λ‹Ή β†’ κΈ°μ΅΄ λΈλΌμ°μ € μ„Έμ…μ UUIDμ™€ λ¶μΌμΉ
- **μμ •**: μ„Έμ… ν…μ΄λΈ”μ—μ„ Peterμ 3κ° μ„Έμ…μ„ μ¬λ°”λ¥Έ UUID(`74058d55-ab99-4042-aa8e-da506713ba06`)λ΅ μ—…λ°μ΄νΈ

### π  High β€” μ„Έμ… μΏ ν‚¤ μ¶”μ¶ μ‹¤ν¨
- **λ¬Έμ **: μ„λ²„κ°€ Set-Cookie 3κ° μ „μ†΅ (2κ° λ§λ£ + 1κ° μ ν¨), μλ»λ λ§λ£ μΏ ν‚¤λ¥Ό μ¶”μ¶
- **μμ •**: `wbsaleshub_session=s%3A` ν¨ν„΄μΌλ΅ μ ν¨ μ„λ… μ„Έμ… μΏ ν‚¤ μ‹λ³„

### π΅ Medium β€” E2E μ…€λ ‰ν„° λ¶μΌμΉ
- **λ¬Έμ **: `a[href="/meeting-notes"]` μ…€λ ‰ν„°κ°€ μ¤ν…μ΄μ§•μ—μ„ λ―Έλ§¤μΉ­, λ²„νΌ strict mode μ„λ°
- **μμ •**: ν…μ¤νΈ κΈ°λ° μ…€λ ‰ν„°(`hasText: 'λ―Έν…λ…ΈνΈ'`), `exact: true` μ‚¬μ©

### π΅ Medium β€” RTZR API ν™κ²½λ³€μ λ―Έμ„¤μ •
- **λ¬Έμ **: μ¤ν…μ΄μ§• ν™κ²½μ— `RTZR_CLIENT_ID`, `RTZR_CLIENT_SECRET` λ―Έμ„¤μ •
- **μν–¥**: νμΌ μ—…λ΅λ“λ” μ„±κ³µν•λ‚ STT λ³€ν™ μ¦‰μ‹ μ‹¤ν¨
- **μƒνƒ**: λ―Έν•΄κ²° β€” RTZR API ν‚¤ λ°κΈ‰ λ° ν™κ²½λ³€μ μ„¤μ • ν•„μ”

---

## 5. ν…μ¤νΈ κ³„μ • μ •λ³΄

| ν•­λ© | κ°’ |
|------|-----|
| μ΄λ©”μΌ | test@wavebridge.com |
| λΉ„λ°€λ²νΈ | test1234 |
| HubManager ID | 29 |
| SalesHub UUID | 2843c608-fd59-4c26-a544-5a345530e42c |
| μ—­ν•  | MEMBER |
| Hub Membership | hub_id=1 (wbsaleshub), ACTIVE |

---

## 6. ν…μ¤νΈ νμΌ λ©λ΅

| νμΌ | μ ν• | ν…μ¤νΈ μ |
|------|------|----------|
| `tests/voice/voice-upload-api.test.ts` | API ν†µν•© | 18 |
| `tests/voice/setup.ts` | ν…μ¤νΈ μ„¤μ • | - |
| `vitest.config.voice.ts` | Vitest μ„¤μ • | - |
| `e2e/voice/voice-upload-e2e.spec.ts` | E2E | 11 |
| `playwright.config.voice.ts` | Playwright μ„¤μ • | - |

---

## 7. μ¤ν¬λ¦°μƒ·

κ²½λ΅: `WBSalesHub/test-results/voice/screenshots/`

| νμΌ | μ„¤λ… |
|------|------|
| `01-dashboard.png` | λ€μ‹λ³΄λ“ νμ΄μ§€ |
| `01-dashboard-mic-button.png` | λ§μ΄ν¬ λ²„νΌ ν™•λ€ |
| `02-sidebar-badge.png` | μ‚¬μ΄λ“λ°” λ―Έν…λ…ΈνΈ λ§ν¬ |
| `03-meeting-notes-page.png` | λ―Έν…λ…ΈνΈ νμ΄μ§€ |
| `03-meeting-notes-voice-badges.png` | μμ„± μ—…λ΅λ“ λ°°μ§€ |
| `04-voice-upload-modal-open.png` | μ—…λ΅λ“ λ¨λ‹¬ (μ—΄λ¦° μƒνƒ) |
| `04-voice-upload-modal-closed.png` | λ¨λ‹¬ λ‹«ν ν›„ |
| `04-voice-upload-file-selected.png` | **μ‹¤μ  m4a νμΌ μ„ νƒλ¨** |
| `04-voice-upload-submitted.png` | μ—…λ΅λ“ μ™„λ£ |
| `06-meeting-notes-all-states.png` | μƒνƒλ³„ μΉ΄λ“ ν‘μ‹ |
| `07-source-badges.png` | μ†μ¤ λ°°μ§€ μƒ‰μƒ |

---

## 8. λ‹¤μ λ‹¨κ³„

1. **RTZR API ν‚¤ μ„¤μ •**: `RTZR_CLIENT_ID`, `RTZR_CLIENT_SECRET` ν™κ²½λ³€μλ¥Ό μ¤ν…μ΄μ§• `.env.staging`μ— μ¶”κ°€
2. **μ „μ²΄ νμ΄ν”„λΌμΈ ν…μ¤νΈ**: RTZR ν‚¤ μ„¤μ • ν›„ μ‹¤μ  μμ„± β†’ STT β†’ AI μ”μ•½ β†’ ν™•μΈ ν”λ΅μ° κ²€μ¦
3. **confirm λ¨λ‹¬ ν…μ¤νΈ**: pending_confirm μƒνƒ λ…ΈνΈκ°€ μƒμ„±λ ν›„ ν™•μΈ λ¨λ‹¬ UI ν…μ¤νΈ
