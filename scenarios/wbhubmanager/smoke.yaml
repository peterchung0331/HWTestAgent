# WBHubManager Smoke Test Scenario
# 5 critical checks for quick verification during development

name: "HubManager Smoke Test"
slug: "smoke"
description: "개발 중 필수 기능 빠른 체크 (5개 항목, 1분 이내)"
type: SMOKE
environment: development
timeout: 60000  # 1 minute
retries: 1      # 실패 시 1회 재시도

variables:
  TARGET_URL: "http://localhost:3090"

checks:
  # ============================================
  # Check 1: Health Check API
  # ============================================
  - id: health-check
    name: "Health Check API"
    priority: critical
    request:
      method: GET
      url: "{{TARGET_URL}}/api/health"
      timeout: 5000
    expected:
      status: 200
      body:
        contains: "ok"
        # JSON 구조: { success: true, status: "ok" }

  # ============================================
  # Check 2: JWT Public Key 조회
  # ============================================
  - id: jwt-public-key
    name: "JWT Public Key 조회"
    priority: critical
    request:
      method: GET
      url: "{{TARGET_URL}}/api/auth/public-key"
      timeout: 5000
    expected:
      status: 200
      body:
        hasKey: "publicKey"
        # JSON 구조: { success: true, data: { publicKey: "...", algorithm: "RS256" } }

  # ============================================
  # Check 3: Hub 목록 조회
  # ============================================
  - id: hub-list
    name: "Hub 목록 조회"
    priority: high
    request:
      method: GET
      url: "{{TARGET_URL}}/api/hubs"
      timeout: 5000
    expected:
      status: 200
      body:
        isArray: true
        # JSON 구조: { success: true, data: [...] }

  # ============================================
  # Check 4: JWT Token 발급 (간단 버전)
  # ============================================
  - id: jwt-token-issue
    name: "JWT Token 발급"
    priority: critical
    request:
      method: POST
      url: "{{TARGET_URL}}/api/auth/google-login"
      headers:
        Content-Type: "application/json"
      body:
        email: "test-smoke@wavebridge.kr"
        name: "SmokeTest"
      timeout: 10000
    expected:
      status: 200
      body:
        hasKey: "accessToken"
        # JSON 구조: { success: true, data: { accessToken: "...", refreshToken: "..." } }

  # ============================================
  # Check 5: DB 연결 확인
  # ============================================
  - id: db-connection
    name: "DB 연결 확인"
    priority: critical
    request:
      method: GET
      url: "{{TARGET_URL}}/api/health/db"
      timeout: 5000
    expected:
      status: 200
      body:
        contains: "connected"
        # JSON 구조: { success: true, database: { status: "connected", ... } }
